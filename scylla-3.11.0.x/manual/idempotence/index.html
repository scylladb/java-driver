

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Query idempotence | ScyllaDB Docs 
        </title>
        <meta name="description" content="ScyllaDB is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="../../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../../_static/img/favicon-228x228.png" />

        
            
        

        
            
            <link rel="canonical" href="https://java-driver.docs.scylladb.com/stable/manual/idempotence/"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
              href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
              href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                  href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b76e3c8a" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../_static/css/main.css?v=74345ccd" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../_static/sphinx_collapse.css?v=226d88b4" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
            
        
    
        
        
            
        <script type="text/javascript" src="../../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../../_static/js/main.bundle.js"></script>
        
            
                <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
            
        
            
                <script src="../../_static/doctools.js?v=888ff710"></script>
            
        
            
                <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
            
        
            
                <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
            
        
            
                <script src="../../_static/copybutton.js?v=f281be69"></script>
            
        
    
            
                <!-- Local meta tags -->
            
            
                <!-- Google Tag Manager global -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager docs -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-54NWVS4");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
            
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        <section class="promo-banner  promo-banner--hide" style="display: none;">
    <div class="promo-banner-wrapper">
        
        <div class="promo-banner__title">ScyllaDB University Live | Free Virtual Training Event</div>
        <a class="promo-banner__button button button--reverse" href="#"
           target="_blank" rel="noopener noreferrer">Learn more</a>
        <button class="promo-banner__close">
            <i class="scylla-icon scylla-icon--close"></i>
        </button>
    </div>
</section>
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../../_static/img/logo-docs.svg" alt="ScyllaDB Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://opensource.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            ScyllaDB Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://enterprise.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>ScyllaDB Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--alternator"></i>
                            ScyllaDB Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="https://docs.scylladb.com/scylla-cloud/" class="scylla-dropdown__title">Cloud</a>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>ScyllaDB Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>ScyllaDB
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>ScyllaDB Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--alternator"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="../../_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
    <div class="admonition caution">
        <p class="admonition-title">Caution</p>
        <p>
            
                You're viewing documentation for a previous version of Scylla Java Driver.
            
            <a href="../../../stable/index.html">Switch to the latest stable version.</a>
        </p>
    </div>

                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://docs.scylladb.com"
           class="bread__highlight">
            <i class="fas fa-home"></i> ScyllaDB Docs
        </a>
    </span>
    <span class="bread__item">
        <a href="https://java-driver.docs.scylladb.com"
           class="bread__highlight">
            Scylla Java Driver
        </a>
    </span>
    
        <span class="bread__item">
            <a href="../index.html" class="bread__highlight">
                Manual
            </a>
        </span>
    
    <span class="bread__item bread__item--last">Query idempotence</span>
</div>
                    </div>
                
                <section id="query-idempotence">
<h1>Query idempotence<a class="headerlink" href="#query-idempotence" title="Link to this heading">¶</a></h1>
<p>A query is <em>idempotent</em> if it can be applied multiple times without changing the result of the initial application. For
example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">update</span> <span class="pre">my_table</span> <span class="pre">set</span> <span class="pre">list_col</span> <span class="pre">=</span> <span class="pre">[1]</span> <span class="pre">where</span> <span class="pre">pk</span> <span class="pre">=</span> <span class="pre">1</span></code> is idempotent: no matter how many times it gets executed, <code class="docutils literal notranslate"><span class="pre">list_col</span></code>
will always end up with the value <code class="docutils literal notranslate"><span class="pre">[1]</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update</span> <span class="pre">my_table</span> <span class="pre">set</span> <span class="pre">list_col</span> <span class="pre">=</span> <span class="pre">[1]</span> <span class="pre">+</span> <span class="pre">list_col</span> <span class="pre">where</span> <span class="pre">pk</span> <span class="pre">=</span> <span class="pre">1</span></code> is not idempotent: if <code class="docutils literal notranslate"><span class="pre">list_col</span></code> was initially empty,
it will contain <code class="docutils literal notranslate"><span class="pre">[1]</span></code> after the first execution, <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">1]</span></code> after the second, etc.</p></li>
</ul>
<p>Idempotence matters for <a class="reference external" href="../retries/">retries</a> and <a class="reference external" href="../speculative_execution/">speculative query executions</a>. The driver
will bypass those features if the <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-3.11.0.x/api/com/datastax/driver/core/Statement.html#isIdempotent--">Statement#isIdempotent()</a> flag is set to <code class="docutils literal notranslate"><span class="pre">false</span></code>, to ensure that the
statement does not get executed more than once.</p>
<p>In most cases, you must set that flag manually. The driver does not parse query strings, so it can’t infer it
automatically (except for statements coming from the query builder, see below).</p>
<p>Statements start out as non-idempotent by default. You can override the flag on each statement:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Statement</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleStatement</span><span class="p">(</span><span class="s">&quot;SELECT * FROM users WHERE id = 1&quot;</span><span class="p">);</span>
<span class="n">s</span><span class="p">.</span><span class="na">setIdempotent</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
<p>The default is also configurable: if you want all statements to start out as idempotent, do this:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Make all statements idempotent by default:</span>
<span class="n">cluster</span><span class="p">.</span><span class="na">getConfiguration</span><span class="p">().</span><span class="na">getQueryOptions</span><span class="p">().</span><span class="na">setDefaultIdempotence</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
<p>Any statement on which you didn’t call <code class="docutils literal notranslate"><span class="pre">setIdempotent</span></code> gets this default value.</p>
<p>Bound statements inherit the flag from the prepared statement they were created from:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">prepare</span><span class="p">(</span><span class="s">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span class="p">);</span>
<span class="c1">// This cast is for backward-compatibility reasons. On 3.0+, you can do pst.setIdempotent(true) directly</span>
<span class="p">((</span><span class="n">IdempotenceAwarePreparedStatement</span><span class="p">)</span><span class="w"> </span><span class="n">pst</span><span class="p">).</span><span class="na">setIdempotent</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

<span class="n">BoundStatement</span><span class="w"> </span><span class="n">bst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pst</span><span class="p">.</span><span class="na">bind</span><span class="p">();</span>
<span class="k">assert</span><span class="w"> </span><span class="n">bst</span><span class="p">.</span><span class="na">isIdempotent</span><span class="p">();</span>
</pre></div>
</div>
<section id="idempotence-in-the-query-builder">
<h2>Idempotence in the query builder<a class="headerlink" href="#idempotence-in-the-query-builder" title="Link to this heading">¶</a></h2>
<p>The <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-3.11.0.x/api/com/datastax/driver/core/querybuilder/QueryBuilder.html">QueryBuilder</a> DSL tries to infer the <code class="docutils literal notranslate"><span class="pre">isIdempotent</span></code> flag on the statements it generates. The following statements
will be marked <strong>non-idempotent</strong>:</p>
<ul>
<li><p>counter updates:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">update</span><span class="p">(</span><span class="s">&quot;mytable&quot;</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="n">incr</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">)).</span><span class="na">where</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="s">&quot;k&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</li>
<li><p>prepend, append or deletion operations on lists:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">update</span><span class="p">(</span><span class="s">&quot;mytable&quot;</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;l&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="na">where</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="s">&quot;k&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="n">delete</span><span class="p">().</span><span class="na">listElt</span><span class="p">(</span><span class="s">&quot;l&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="na">from</span><span class="p">(</span><span class="s">&quot;mytable&quot;</span><span class="p">).</span><span class="na">where</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="s">&quot;k&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
</li>
<li><p>queries that insert the result of a function call or a “raw” string in a column (or as an element in a collection
column):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">update</span><span class="p">(</span><span class="s">&quot;mytable&quot;</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">now</span><span class="p">())).</span><span class="na">where</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="s">&quot;k&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="n">update</span><span class="p">(</span><span class="s">&quot;mytable&quot;</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fcall</span><span class="p">(</span><span class="s">&quot;myCustomFunc&quot;</span><span class="p">))).</span><span class="na">where</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="s">&quot;k&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="n">update</span><span class="p">(</span><span class="s">&quot;mytable&quot;</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">raw</span><span class="p">(</span><span class="s">&quot;myCustomFunc()&quot;</span><span class="p">))).</span><span class="na">where</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="s">&quot;k&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
</pre></div>
</div>
<p>This is a conservative approach, since the driver can’t guess whether a function is idempotent, or what a raw string
contains. It might yield false negatives, that you’ll have to fix manually.</p>
</li>
<li><p>lightweight transactions (see the next section for a detailed explanation):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">insertInto</span><span class="p">(</span><span class="s">&quot;mytable&quot;</span><span class="p">).</span><span class="na">value</span><span class="p">(</span><span class="s">&quot;k&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="na">value</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">).</span><span class="na">ifNotExists</span><span class="p">();</span>
</pre></div>
</div>
</li>
</ul>
<p>If these rules produce a false negative, you can manually override the flag on the built statement:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BuiltStatement</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="s">&quot;mytable&quot;</span><span class="p">).</span><span class="na">with</span><span class="p">(</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fcall</span><span class="p">(</span><span class="s">&quot;anIdempotentFunc&quot;</span><span class="p">))).</span><span class="na">where</span><span class="p">(</span><span class="n">eq</span><span class="p">(</span><span class="s">&quot;k&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>

<span class="c1">// False negative because the driver can&#39;t guess that anIdempotentFunc() is safe</span>
<span class="k">assert</span><span class="w"> </span><span class="o">!</span><span class="n">s</span><span class="p">.</span><span class="na">isIdempotent</span><span class="p">();</span>

<span class="c1">// Fix it</span>
<span class="n">s</span><span class="p">.</span><span class="na">setIdempotent</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="idempotence-and-lightweight-transactions">
<h2>Idempotence and lightweight transactions<a class="headerlink" href="#idempotence-and-lightweight-transactions" title="Link to this heading">¶</a></h2>
<p>As explained in the previous section, the query builder considers lightweight transactions as non-idempotent. This might
sound counter-intuitive, as these queries can sometimes be safe to execute multiple times. For example, consider the
following query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">mytable</span> <span class="n">SET</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">4</span> <span class="n">WHERE</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">IF</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>If we execute it twice, the <code class="docutils literal notranslate"><span class="pre">IF</span></code> condition will fail the second time, so the second execution will do nothing and <code class="docutils literal notranslate"><span class="pre">v</span></code>
will still have the value 4.</p>
<p>However, the problem appears when we consider multiple clients executing the query with retries:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">v</span></code> has the value 1;</p></li>
<li><p>client 1 executes the query above, performing a a CAS (compare and set) from 1 to 4;</p></li>
<li><p>client 1’s connection drops, but the query completes successfully. <code class="docutils literal notranslate"><span class="pre">v</span></code> now has the value 4;</p></li>
<li><p>client 2 executes a CAS from 4 to 2;</p></li>
<li><p>client 2’s transaction succeeds. <code class="docutils literal notranslate"><span class="pre">v</span></code> now has the value 2;</p></li>
<li><p>since client 1 lost its connection, it considers the query as failed, and transparently retries the CAS from 1 to 4.
But since the column now has value 2, it receives a “not applied” response.</p></li>
</ol>
<p>One important aspect of lightweight transactions is <a class="reference external" href="https://en.wikipedia.org/wiki/Linearizability#Definition_of_linearizability">linearizability</a>: given a set of concurrent operations on a column
from different clients, there must be a way to reorder them to yield a sequential history that is correct. From our
clients’ point of view, there were two operations:</p>
<ul class="simple">
<li><p>client 1 executed a CAS from 1 to 4, that was not applied;</p></li>
<li><p>client 2 executed a CAS from 4 to 2, that was applied.</p></li>
</ul>
<p>But overall the column changed from 1 to 2. There is no ordering of the two operations that can explain that change. We
broke linearizability by doing a transparent retry at step 6.</p>
<p>If linearizability is important for you, you should ensure that lightweight transactions are appropriately flagged as
not idempotent.</p>
</section>
</section>

                
                    <div class="post-content">
                        
    <div class="feedback-container">
        <p class="feedback-container__title">Was this page helpful?</p>
        <span data-tooltip tabindex="1" title="Yes" data-position="top">
            <button class="feedback-container__button" id="feedback-positive">
                <i class="feedback-container__icon scylla-icon scylla-icon--thumbs-up"></i>
            </button>
        </span>
        <span data-tooltip tabindex="1" title="No" data-position="top">
            <button class="feedback-container__button" id="feedback-negative">
                <i class="feedback-container__icon scylla-icon scylla-icon--thumbs-down"></i>
            </button>
        </span>
        <div class="feedback-container__message" id="feedback-message"></div>
    </div>

    <script>
        function resetFeedbackButtonActive() {
            const feedbackButtons = document.getElementsByClassName('feedback-container__button');
            for (let i = 0; i < feedbackButtons.length; i++) {
                feedbackButtons[i].classList.remove('active');
            }
        }

        function showMessage(liked) {
            const feedbackMessage = document.getElementById('feedback-message');
            const themeGithubRepository = true;
            let message = 'Great! Thanks for your feedback.';
            if (themeGithubRepository && !liked) {
                message = "Thanks for your feedback! Please don't hesitate to <a href='https://github.com/scylladb/java-driver/issues/new?title=docs:%20Issue on page Query idempotence&&body=I%20would%20like%20to%20report%20an%20issue%20on%20page%20https://java-driver.docs.scylladb.com/scylla-3.11.0.x/manual/idempotence/index%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix&labels=documentation'>create an issue</a> if you have any suggestions on how we can improve.";
            }
            feedbackMessage.innerHTML = message;
        }

        function sendGaEvent(liked) {
            const event_label = liked ? "positive" : "negative";
            const event = "feedback_" + event_label;
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': event,
            });
        }

        const positiveFeebackButton = document.getElementById('feedback-positive');
        const negativeFeedbackButton = document.getElementById('feedback-negative');

        positiveFeebackButton.addEventListener('click', function() {
            resetFeedbackButtonActive();
            sendGaEvent(true);
            showMessage(true);
            positiveFeebackButton.classList.add('active');
        });

        negativeFeedbackButton.addEventListener('click', function() {
            resetFeedbackButtonActive();
            sendGaEvent(false);
            showMessage(false);
            negativeFeedbackButton.classList.add('active');
        });
    </script>

                        <div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="../custom_payloads/index.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Custom Payloads
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="../load_balancing/index.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Load balancing
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div>
                        <div class="notice">
    <p>ScyllaDB Java Driver is available under the <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache v2 License</a>.
    ScyllaDB Java Driver is a fork of <a href="https://github.com/datastax/java-driver">DataStax Java Driver</a>.
    See Copyright <a href="https://java-driver.docs.scylladb.com/stable/#license">here</a>.</p>
</div>
                    </div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content" style="visibility: hidden;">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__title">
            <a href="https://java-driver.docs.scylladb.com">Scylla Java Driver</a>
        </div>
        <div class="side-nav__versions"><ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
    <li class="scylla-dropdown__item">
        <a class="scylla-dropdown__title" href="#">
            
                3.11.0.x
            
            <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
        </a>
        <ul class="menu scylla-dropdown__content">
            
                
                    <li>
                        <a href="../../../stable/index.html">4.15.0.x</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../../scylla-4.14.1.x/index.html">4.14.1.x</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../../scylla-4.13.0.x/index.html">4.13.0.x</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../../scylla-4.12.0.x/index.html">4.12.0.x</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../../scylla-4.11.1.x/index.html">4.11.1.x</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../../scylla-4.10.0.x/index.html">4.10.0.x</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../../scylla-4.7.2.x/index.html">4.7.2.x</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../../scylla-3.11.2.x/index.html">3.11.2.x</a>
                    </li>
                
            
                
                    <li>
                        <a href="index.html">3.11.0.x</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../../scylla-3.10.2.x/index.html">3.10.2.x</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../../scylla-3.7.2.x/index.html">3.7.2.x</a>
                    </li>
                
            
            
        </ul>
    </li>
</ul></div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Scylla Java Driver for Scylla and Apache Cassandra®</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Documentation</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Manual</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../address_resolution/index.html">Address resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../async/index.html">Asynchronous programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auth/index.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compression/index.html">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../control_connection/index.html">Control connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../custom_codecs/index.html">Custom Codecs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../custom_payloads/index.html">Custom Payloads</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Query idempotence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../load_balancing/index.html">Load balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/index.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metadata/index.html">Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics/index.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../native_protocol/index.html">Native protocol</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../object_mapper/index.html">Object Mapper</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../object_mapper/creating/index.html">Definition of mapped classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../object_mapper/custom_codecs/index.html">Using custom codecs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../object_mapper/using/index.html">Using the mapper</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../osgi/index.html">OSGi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../paging/index.html">Paging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pooling/index.html">Connection pooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../query_timestamps/index.html">Query timestamps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reconnection/index.html">Reconnection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../retries/index.html">Retries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shaded_jar/index.html">Using the shaded JAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../socket_options/index.html">Socket options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../speculative_execution/index.html">Speculative query execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ssl/index.html">SSL</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../statements/index.html">Statements</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../statements/simple/index.html">Simple statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../statements/prepared/index.html">Prepared statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../statements/built/index.html">Built statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../statements/batch/index.html">Batch statements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tuples/index.html">Using Tuples with the Java driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../udts/index.html">User-defined types</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../upgrade_guide/index.html">Upgrade guide</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../upgrade_guide/migrating_from_astyanax/index.html">Migrating from Astyanax</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../upgrade_guide/migrating_from_astyanax/configuration/index.html">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../upgrade_guide/migrating_from_astyanax/language_level_changes/index.html">Language change : from Thrift to CQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../upgrade_guide/migrating_from_astyanax/queries_and_results/index.html">Queries and Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/index.html">Changelog</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/java-driver/issues/new?title=docs:%20Issue on page Query idempotence&&body=I%20would%20like%20to%20report%20an%20issue%20on%20page%20https://java-driver.docs.scylladb.com/scylla-3.11.0.x/manual/idempotence/index%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix&labels=documentation"
               target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                <a href="https://github.com/scylladb/java-driver/edit/master/docs/source/manual/idempotence/index.md"
                   target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Query idempotence</a><ul>
<li><a class="reference internal" href="#idempotence-in-the-query-builder">Idempotence in the query builder</a></li>
<li><a class="reference internal" href="#idempotence-and-lightweight-transactions">Idempotence and lightweight transactions</a></li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="../../_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/" target="_blank">Docs</a>
                <a class="footer-links__link" href="https://university.scylladb.com/" target="_blank">University</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/" target="_blank">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/" target="_blank">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="../../_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="../../_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="https://forum.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="Community forum" data-position="bottom">
                        <img src="../../_static/img/icons/icon-forum.svg" alt="Forum Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2024, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 05 August 2024.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.7.4</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                    style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>