


<!doctype html>
<html class="no-js" lang="en">
  
<head><!-- begin head.html -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
    Prepared statements | Scylla Docs
    </title>
    <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />

    <link rel="icon" href="../../../_static/img/favicon.ico" type="image/x-icon"/>
    <link rel="canonical" href="https://docs.scylladb.com/">

    <link rel="author" href="mailto:info@scylladb.com">
    <link rel="stylesheet" href="../../../_static/" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_tabs/tabs.css" />
    
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/foundation.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/doc/main.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>

    <script src="../../../_static/js/vendor/modernizr.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T8P2JP');</script>
    <!-- End Google Tag Manager -->

    <!-- Marketo -->
    <script type="text/javascript"> (function() { var didInit = false; function initMunchkin() { if(didInit === false) { didInit = true; Munchkin.init('791-QBF-350'); } } var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//munchkin.marketo.net/munchkin.js'; s.onreadystatechange = function() { if (this.readyState == 'complete' || this.readyState == 'loaded') { initMunchkin(); } }; s.onload = initMunchkin; document.getElementsByTagName('head')[0].appendChild(s); })(); </script>
    <!-- End Marketo -->

<!-- end head.html -->
</head>

<body>
<header id="header" class="animated">
    <div class="topbar_continer contain-to-grid clearfix">
        <nav class="top-bar" id="top-bar" data-topbar role="navigation">
            <ul class="title-area">
                <li class="name">
                    <div class="logo">
                        <a href="https://docs.scylladb.com/"><img src="../../../_static/img/logo-scylla-docs.svg" alt="" width="151"></a>
                    </div>
                </li>
                <li class="toggle-topbar"><a href="#"><span class="icon-manu"></span></a></li>
            </ul>
            <section class="top-bar-section clearfix">
                <ul class="right">
                    
                    <li>
                        <a href="https://scylladb.github.io/java-driver/">Scylla Java Driver</a>
                    </li>
                    
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">Scylla Cloud</a>
                    </li>
                    
                    <li>
                        <a href="https://university.scylladb.com/">Scylla University</a>
                    </li>
                    
                    <li>
                        <a href="https://www.scylladb.com/">ScyllaDB Home</a>
                    </li>
                    
                    <li class="search_continer show-for-medium-up">	
                        <ci-search></ci-search>	
                    </li>	
                </ul>
            </section>
        </nav>
    </div>
</header>
<section id="content">
    <div class="row">
	
	<div class="large-6 large-push-3 columns">
            <div class="section" id="prepared-statements">
<h1>Prepared statements<a class="headerlink" href="#prepared-statements" title="Permalink to this headline">¶</a></h1>
<p>Use <a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/PreparedStatement.html">PreparedStatement</a> for queries that are executed multiple times in your application:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">PreparedStatement</span> <span class="n">prepared</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span>
  <span class="s">&quot;insert into product (sku, description) values (?, ?)&quot;</span><span class="o">);</span>

<span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">prepared</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="s">&quot;234827&quot;</span><span class="o">,</span> <span class="s">&quot;Mouse&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">bound</span><span class="o">);</span>

<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">prepared</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="s">&quot;987274&quot;</span><span class="o">,</span> <span class="s">&quot;Keyboard&quot;</span><span class="o">));</span>
</pre></div>
</div>
<p>When you prepare the statement, Cassandra will parse the query string, cache the result and return a unique identifier
(the <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code> object keeps an internal reference to that identifier):</p>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>client                   driver           Cassandra
--+------------------------+----------------+------
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span> session.prepare<span class="o">(</span>query<span class="o">)</span> <span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span>-----------------------&gt;<span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span> PREPARE<span class="o">(</span>query<span class="o">)</span> <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>---------------&gt;<span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span> - compute id
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span> - parse query string
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span> - cache <span class="o">(</span>id, parsed<span class="o">)</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span> PREPARED<span class="o">(</span>id<span class="o">)</span>   <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>&lt;---------------<span class="p">|</span>
  <span class="p">|</span>  PreparedStatement<span class="o">(</span>id<span class="o">)</span> <span class="p">|</span>                <span class="p">|</span>
  <span class="p">|</span>&lt;-----------------------<span class="p">|</span>                <span class="p">|</span>
</pre></div>
</div>
<p>When you bind and execute a prepared statement, the driver will only send the identifier, which allows Cassandra to
skip the parsing phase:</p>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>client                            driver                Cassandra
--+---------------------------------+---------------------+------
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span> session.execute<span class="o">(</span>BoundStatement<span class="o">)</span> <span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span>--------------------------------&gt;<span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span> EXECUTE<span class="o">(</span>id, values<span class="o">)</span> <span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>--------------------&gt;<span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span> - get cache<span class="o">(</span>id<span class="o">)</span>
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span> - execute query
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>          ROWS       <span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>&lt;--------------------<span class="p">|</span>
  <span class="p">|</span>                                 <span class="p">|</span>                     <span class="p">|</span>
  <span class="p">|</span>&lt;--------------------------------<span class="p">|</span>                     <span class="p">|</span>
</pre></div>
</div>
<p>You should prepare only once, and cache the <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code> in your application (it is thread-safe). If you call
<code class="docutils literal notranslate"><span class="pre">prepare</span></code> multiple times with the same query string, the driver will log a warning.</p>
<p>If you execute a query only once, a prepared statement is inefficient because it requires two roundtrips. Consider a
<a class="reference external" href="../simple/">simple statement</a> instead.</p>
<div class="section" id="parameters-and-binding">
<h2>Parameters and binding<a class="headerlink" href="#parameters-and-binding" title="Permalink to this headline">¶</a></h2>
<p>Parameters can be either anonymous or named (named parameters are only
available with <a class="reference external" href="../../native_protocol">native protocol</a> v2 or above):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ps1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="s">&quot;insert into product (sku, description) values (?, ?)&quot;</span><span class="o">);</span>
<span class="n">ps2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="s">&quot;insert into product (sku, description) values (:s, :d)&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>To turn the statement into its executable form, you need to <em>bind</em> it to create a <a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/BoundStatement.html">BoundStatement</a>. As shown previously,
there is a shorthand to provide the parameters in the same call:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">ps1</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="s">&quot;324378&quot;</span><span class="o">,</span> <span class="s">&quot;LCD screen&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>You can also bind first, then use setters, which is slightly more
explicit:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Positional setters:</span>
<span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">ps1</span><span class="o">.</span><span class="na">bind</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="s">&quot;324378&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">&quot;LCD screen&quot;</span><span class="o">);</span>

<span class="c1">// Named setters:</span>
<span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">ps2</span><span class="o">.</span><span class="na">bind</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;s&quot;</span><span class="o">,</span> <span class="s">&quot;324378&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;d&quot;</span><span class="o">,</span> <span class="s">&quot;LCD screen&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>You can use named setters even if the query uses anonymous parameters;
Cassandra will name the parameters after the column they apply to:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">ps1</span><span class="o">.</span><span class="na">bind</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;sku&quot;</span><span class="o">,</span> <span class="s">&quot;324378&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;description&quot;</span><span class="o">,</span> <span class="s">&quot;LCD screen&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>This can be ambiguous if the query uses the same column multiple times,
for example: <code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">*</span> <span class="pre">from</span> <span class="pre">sales</span> <span class="pre">where</span> <span class="pre">sku</span> <span class="pre">=</span> <span class="pre">?</span> <span class="pre">and</span> <span class="pre">date</span> <span class="pre">&gt;</span> <span class="pre">?</span> <span class="pre">and</span> <span class="pre">date</span> <span class="pre">&lt;</span> <span class="pre">?</span></code>. In these situations, use positional setters or named parameters.</p>
<p>For native protocol V3 or below, all variables must be bound.  With native
protocol V4 or above, variables can be left unset, in which case they
will be ignored server side (no tombstones will be generated).  If you’re
reusing a bound statement you can use the <code class="docutils literal notranslate"><span class="pre">unset</span></code> method to unset variables
that were previously set:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">ps1</span><span class="o">.</span><span class="na">bind</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;sku&quot;</span><span class="o">,</span> <span class="s">&quot;324378&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;description&quot;</span><span class="o">,</span> <span class="s">&quot;LCD screen&quot;</span><span class="o">);</span>

<span class="c1">// Using the unset method to unset previously set value.</span>
<span class="c1">// Positional setter:</span>
<span class="n">bound</span><span class="o">.</span><span class="na">unset</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

<span class="c1">// Named setter:</span>
<span class="n">bound</span><span class="o">.</span><span class="na">unset</span><span class="o">(</span><span class="s">&quot;description&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>A bound statement also has getters to retrieve the values. Note that
this has a small performance overhead since values are stored in their
serialized form.</p>
<p><code class="docutils literal notranslate"><span class="pre">BoundStatement</span></code> is <strong>not thread-safe</strong>. You can reuse an instance multiple times with different parameters, but only
from a single thread and only if you use synchronous calls:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">ps1</span><span class="o">.</span><span class="na">bind</span><span class="o">();</span>

<span class="c1">// This is safe:</span>
<span class="n">bound</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;sku&quot;</span><span class="o">,</span> <span class="s">&quot;324378&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">bound</span><span class="o">);</span>

<span class="n">bound</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;sku&quot;</span><span class="o">,</span> <span class="s">&quot;324379&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">bound</span><span class="o">);</span>

<span class="c1">// This is NOT SAFE. executeAsync runs concurrently with your code, so the first execution might actually read the</span>
<span class="c1">// values after the second setString call, and you would insert 324381 twice:</span>
<span class="n">bound</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;sku&quot;</span><span class="o">,</span> <span class="s">&quot;324380&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">executeAsync</span><span class="o">(</span><span class="n">bound</span><span class="o">);</span>

<span class="n">bound</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">&quot;sku&quot;</span><span class="o">,</span> <span class="s">&quot;324381&quot;</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">executeAsync</span><span class="o">(</span><span class="n">bound</span><span class="o">);</span>
</pre></div>
</div>
<p>Also, make sure you don’t accidentally reuse parameters from previous executions.</p>
</div>
<div class="section" id="preparing-on-multiple-nodes">
<h2>Preparing on multiple nodes<a class="headerlink" href="#preparing-on-multiple-nodes" title="Permalink to this headline">¶</a></h2>
<p>Cassandra does not replicate prepared statements across the cluster. It is the
driver’s responsibility to ensure that each node’s cache is up to
date. It uses a number of strategies to achieve this:</p>
<ol>
<li><p>When a statement is initially prepared, it is first sent to a single
node in the cluster (this avoids hitting all nodes in case
the query string is wrong). Once that node replies successfully, the
driver re-prepares on all remaining nodes:</p>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>client                   driver           node1          node2  node3
--+------------------------+----------------+--------------+------+---
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span> session.prepare<span class="o">(</span>query<span class="o">)</span> <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>-----------------------&gt;<span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span> PREPARE<span class="o">(</span>query<span class="o">)</span> <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>---------------&gt;<span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span> PREPARED<span class="o">(</span>id<span class="o">)</span>   <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>&lt;---------------<span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>           PREPARE<span class="o">(</span>query<span class="o">)</span>      <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>------------------------------&gt;<span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>           PREPARE<span class="o">(</span>query<span class="o">)</span>      <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>-------------------------------------&gt;<span class="p">|</span>
  <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
  <span class="p">|</span>&lt;-----------------------<span class="p">|</span>                <span class="p">|</span>              <span class="p">|</span>      <span class="p">|</span>
</pre></div>
</div>
<p>The prepared statement identifier is deterministic (it’s a hash of the query string), so it is the same
for all nodes.</p>
</li>
<li><p>if a node crashes, it loses all of its prepared statements. So the
driver keeps a client-side cache; anytime a node is marked back up,
the driver re-prepares all statements on it;</p></li>
<li><p>finally, if the driver tries to execute a statement and finds out
that the coordinator doesn’t know about it, it will re-prepare the
statement on the fly (this is transparent for the client, but will cost
two extra roundtrips):</p>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>client                          driver                         node1
--+-------------------------------+------------------------------+--
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>session.execute<span class="o">(</span>boundStatement<span class="o">)</span><span class="p">|</span>                              <span class="p">|</span>
  +------------------------------&gt;<span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>     EXECUTE<span class="o">(</span>id, values<span class="o">)</span>      <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>-----------------------------&gt;<span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>         UNPREPARED           <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>&lt;-----------------------------<span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>       PREPARE<span class="o">(</span>query<span class="o">)</span>         <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>-----------------------------&gt;<span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>        PREPARED<span class="o">(</span>id<span class="o">)</span>          <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>&lt;-----------------------------<span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>     EXECUTE<span class="o">(</span>id, values<span class="o">)</span>      <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>-----------------------------&gt;<span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>             ROWS             <span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>&lt;-----------------------------<span class="p">|</span>
  <span class="p">|</span>                               <span class="p">|</span>                              <span class="p">|</span>
  <span class="p">|</span>&lt;------------------------------<span class="p">|</span>                              <span class="p">|</span>
</pre></div>
</div>
</li>
</ol>
<p>You can customize these strategies through <code class="docutils literal notranslate"><span class="pre">QueryOptions</span></code>:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/QueryOptions.html#setPrepareOnAllHosts-boolean-">setPrepareOnAllHosts</a> controls whether statements are initially
re-prepared on other hosts (step 1 above);</p></li>
<li><p><a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/QueryOptions.html#setReprepareOnUp-boolean-">setReprepareOnUp</a> controls whether statements are re-prepared on a
node that comes back up (step 2 above).</p></li>
</ul>
<p>Changing the driver’s defaults should be done with care and only in
specific situations; read each method’s Javadoc for detailed
explanations.</p>
</div>
<div class="section" id="avoid-preparing-select-queries">
<h2>Avoid preparing ‘SELECT *’ queries<a class="headerlink" href="#avoid-preparing-select-queries" title="Permalink to this headline">¶</a></h2>
<p>Both the driver and Cassandra maintain a mapping of <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code> queries to their
metadata.  When a change is made to a table, such as a column being added or dropped, there
is currently no mechanism for Cassandra to invalidate the existing metadata.  Because of this,
the driver is not able to properly react to these changes and will improperly read rows after
a schema change is made.</p>
<p>Therefore it is currently recommended to list all columns of interest in
your prepared statements (i.e. <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c</span> <span class="pre">FROM</span> <span class="pre">table</span></code>), instead of
relying on <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span></code>.</p>
<p>This will be addressed in a future release of both Cassandra and the driver.  Follow
<a class="reference external" href="https://issues.apache.org/jira/browse/CASSANDRA-10786">CASSANDRA-10786</a> and <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-1196">JAVA-1196</a> for more information.</p>
</div>
</div>

        </div>

        <div id="sidebar" class="large-3 large-pull-6 columns"><div class="side-nav">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../README.html">Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../address_resolution/README.html">Address resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../async/README.html">Asynchronous programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../auth/README.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cloud/README.html">Connecting to Apollo (Cloud)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../compression/README.html">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../control_connection/README.html">Control connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../custom_codecs/README.html">Custom Codecs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../custom_payloads/README.html">Custom Payloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../idempotence/README.html">Query idempotence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../load_balancing/README.html">Load balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/README.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../metadata/README.html">Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../metrics/README.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../native_protocol/README.html">Native protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../object_mapper/README.html">Object Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../osgi/README.html">OSGi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../paging/README.html">Paging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pooling/README.html">Connection pooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../query_timestamps/README.html">Query timestamps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reconnection/README.html">Reconnection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../retries/README.html">Retries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shaded_jar/README.html">Using the shaded JAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../socket_options/README.html">Socket options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../speculative_execution/README.html">Speculative query execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ssl/README.html">SSL</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../README.html">Statements</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../simple/README.html">Simple statements</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Prepared statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../built/README.html">Built statements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../batch/README.html">Batch statements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tuples/README.html">Using Tuples with the Java driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../udts/README.html">User-defined types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../upgrade_guide/README.html">Upgrade guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/README.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog/README.html">Changelog</a></li>
</ul>

</div>
        </div>

        <div class="large-3 columns">
            
        </div>

    </div>
</section>

<!-- newsleter modal -->

<div id="newsletter_signup" class="reveal-modal tiny radius dark_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <a class="close-reveal-modal" aria-label="Close">×</a>
    <h2 id="modalTitle">Sign up for the Scylla newsletter</h2>
    <div id="mc_embed_signup">
        <form action="//cloudius-systems.us10.list-manage.com/subscribe/post?u=df8bb543c68230d5f7b4dcf78&amp;id=9a4589f144" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
            <div id="mc_embed_signup_scroll">

                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-EMAIL">Email</label></div>
                        <div class="small-9 columns"><input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-FNAME">First Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="FNAME" class="" id="mce-FNAME"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-LNAME">Last Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="LNAME" class="" id="mce-LNAME"></div>
                    </div>
                </div>
                <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;"><input type="text" name="b_df8bb543c68230d5f7b4dcf78_9a4589f144" tabindex="-1" value=""></div>
                <div class="clear"><input type="submit" class="button" value="Sign up" name="subscribe" id="mc-embedded-subscribe"></div>
            </div>
        </form>
    </div>
</div>

<!-- end newsleter modal -->



<!-- footer.html -->
<footer id="footer">
    <div class="footer-top">
        <a class="logo" href="https://www.scylladb.com"><img src="../../../_static/img/logo-scylla-horizontal-RGB.svg" alt=""></a>
        <div class="footer-links">
            <a class="link" href="https://docs.scylladb.com">Docs</a>
            <a class="link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
            <a class="link" href="https://www.scylladb.com/company/">About Us</a>
            <a class="link button" href="https://github.com/scylladb/java-driver/issues/new?title=Issue in page Prepared statements&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20http://docs.scylladb.com/manual/statements/prepared/README%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix" target="_blank">
                Report an issue on this page</a>
        </div>
        <div class="footer-actions">
            <a class="link-icon" href="https://github.com/ScyllaDB" target="_blank">
                <span class="icon-github2"></span></a>
            <a class="link-icon" href="https://twitter.com/ScyllaDB" target="_blank">
                <span class="icon-twitter"></span></a>
            <a class="link-icon" href="https://www.linkedin.com/company/scylladb"  target="_blank">
                <span class="icon-linkedin2"></span></a>
            <a class="link-icon" href="https://www.facebook.com/scylladb/" target="_blank">
                <span class="icon-facebook"></span></a>
        </div>
    </div>

    <div class="footer-bottom">
        <div class="footer-info">
            <div class="footer-copyright">
                &#169; 2012, ScyllaDB. All rights reserved.
            </div>
            <div class="footer-last-updated">
                Last updated on 20 October 2020.
            </div>
        </div>
        <div class="footer-links">
        </div>
    </div>
</footer>
<!-- end footer.html -->

<!-- bodyscripts.html -->
<!-- at the end of the BODY --> 
<script src="../../../_static/js/vendor/jquery.js"></script>
<script src="../../../_static/expertrec.js"></script>
<script src="../../../_static/js/foundation/foundation.js"></script>
<script src="../../../_static/js/foundation/foundation.topbar.js"></script>
<script src="../../../_static/app.js"></script>
<script>
    $(document).foundation();
</script>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <!-- end bodyscripts.html -->
</body>
</html>