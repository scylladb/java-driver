


<!doctype html>
<html class="no-js" lang="en">
  
<head><!-- begin head.html -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
    Frequently Asked Questions | Scylla Docs
    </title>
    <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />

    <link rel="icon" href="../_static/img/favicon.ico" type="image/x-icon"/>
    <link rel="canonical" href="https://docs.scylladb.com/">

    <link rel="author" href="mailto:info@scylladb.com">
    <link rel="stylesheet" href="../_static/" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_tabs/tabs.css" />
    
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/foundation.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/doc/main.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>

    <script src="../_static/js/vendor/modernizr.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T8P2JP');</script>
    <!-- End Google Tag Manager -->

    <!-- Marketo -->
    <script type="text/javascript"> (function() { var didInit = false; function initMunchkin() { if(didInit === false) { didInit = true; Munchkin.init('791-QBF-350'); } } var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//munchkin.marketo.net/munchkin.js'; s.onreadystatechange = function() { if (this.readyState == 'complete' || this.readyState == 'loaded') { initMunchkin(); } }; s.onload = initMunchkin; document.getElementsByTagName('head')[0].appendChild(s); })(); </script>
    <!-- End Marketo -->

<!-- end head.html -->
</head>

<body>
<header id="header" class="animated">
    <div class="topbar_continer contain-to-grid clearfix">
        <nav class="top-bar" id="top-bar" data-topbar role="navigation">
            <ul class="title-area">
                <li class="name">
                    <div class="logo">
                        <a href="https://docs.scylladb.com/"><img src="../_static/img/logo-scylla-docs.svg" alt="" width="151"></a>
                    </div>
                </li>
                <li class="toggle-topbar"><a href="#"><span class="icon-manu"></span></a></li>
            </ul>
            <section class="top-bar-section clearfix">
                <ul class="right">
                    
                    <li>
                        <a href="https://scylladb.github.io/java-driver/">Scylla Java Driver</a>
                    </li>
                    
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">Scylla Cloud</a>
                    </li>
                    
                    <li>
                        <a href="https://university.scylladb.com/">Scylla University</a>
                    </li>
                    
                    <li>
                        <a href="https://www.scylladb.com/">ScyllaDB Home</a>
                    </li>
                    
                    <li class="search_continer show-for-medium-up">	
                        <ci-search></ci-search>	
                    </li>	
                </ul>
            </section>
        </nav>
    </div>
</header>
<section id="content">
    <div class="row">
	
	<div class="large-6 large-push-3 columns">
            <div class="section" id="frequently-asked-questions">
<h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="how-do-i-implement-paging">
<h2>How do I implement paging?<a class="headerlink" href="#how-do-i-implement-paging" title="Permalink to this headline">¶</a></h2>
<p>When using <a class="reference external" href="../manual/native_protocol/">native protocol</a> version 2 or
higher, the driver automatically pages large result sets under the hood.
You can also save the paging state to resume iteration later. See <a class="reference external" href="../manual/paging/">this
page</a> for more information.</p>
<p>Native protocol v1 does not support paging, but you can emulate it in
CQL with <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> and the <code class="docutils literal notranslate"><span class="pre">token()</span></code> function. See
<a class="reference external" href="https://groups.google.com/a/lists.datastax.com/d/msg/java-driver-user/U2KzAHruWO4/6vDmUVDDkOwJ">this conversation</a> on the mailing list.</p>
</div>
<div class="section" id="can-i-check-if-a-conditional-statement-lightweight-transaction-was-successful">
<h2>Can I check if a conditional statement (lightweight transaction) was successful?<a class="headerlink" href="#can-i-check-if-a-conditional-statement-lightweight-transaction-was-successful" title="Permalink to this headline">¶</a></h2>
<p>When executing a conditional statement, the <code class="docutils literal notranslate"><span class="pre">ResultSet</span></code> will contain a single <code class="docutils literal notranslate"><span class="pre">Row</span></code> with a
column named “applied” of type boolean. This tells whether the conditional statement was
successful or not.</p>
<p>The driver provides a convenience method <a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/ResultSet.html#wasApplied--">wasApplied</a> to check this on the result set directly:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ResultSet</span> <span class="n">rset</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">conditionalStatement</span><span class="o">);</span>
<span class="n">rset</span><span class="o">.</span><span class="na">wasApplied</span><span class="o">();</span>
</pre></div>
</div>
<p>You may also inspect the value yourself:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ResultSet</span> <span class="n">rset</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">conditionalStatement</span><span class="o">);</span>
<span class="n">Row</span> <span class="n">row</span> <span class="o">=</span> <span class="n">rset</span><span class="o">.</span><span class="na">one</span><span class="o">();</span>
<span class="n">row</span><span class="o">.</span><span class="na">getBool</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>       <span class="c1">// this is equivalent row.getBool(&quot;applied&quot;)</span>
</pre></div>
</div>
<p>Note that, unlike manual inspection, <code class="docutils literal notranslate"><span class="pre">wasApplied</span></code> does not consume the first row.</p>
</div>
<div class="section" id="what-is-a-parameterized-statement-and-how-can-i-use-it">
<h2>What is a parameterized statement and how can I use it?<a class="headerlink" href="#what-is-a-parameterized-statement-and-how-can-i-use-it" title="Permalink to this headline">¶</a></h2>
<p>Starting with Cassandra 2.0, normal statements (that is non-prepared statements) do
not need to concatenate parameter values inside a query string. Instead you can use
<code class="docutils literal notranslate"><span class="pre">?</span></code> markers and provide the values separately:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span> <span class="s">&quot;INSERT INTO contacts (email, firstname, lastname)</span>
<span class="s">      VALUES (?, ?, ?)&quot;</span><span class="o">,</span> <span class="s">&quot;clint.barton@hawkeye.com&quot;</span><span class="o">,</span> <span class="s">&quot;Barney&quot;</span><span class="o">,</span> <span class="s">&quot;Barton&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>See <a class="reference external" href="../manual/statements/simple/">Simple statements</a> for more information.</p>
</div>
<div class="section" id="does-a-parameterized-statement-escape-parameters">
<h2>Does a parameterized statement escape parameters?<a class="headerlink" href="#does-a-parameterized-statement-escape-parameters" title="Permalink to this headline">¶</a></h2>
<p>A parameterized statement sends the values of parameters separate from the query
(similar to the way a prepared statement does) as bytes so there is no need to escape
parameters.</p>
</div>
<div class="section" id="what-s-the-difference-between-a-parameterized-statement-and-a-prepared-statement">
<h2>What’s the difference between a parameterized statement and a Prepared statement?<a class="headerlink" href="#what-s-the-difference-between-a-parameterized-statement-and-a-prepared-statement" title="Permalink to this headline">¶</a></h2>
<p>The only similarity between a parameterized statement and a prepared statement is in
the way that the parameters are sent. The difference is that a prepared statement:</p>
<ul class="simple">
<li><p>is already known on the cluster side (it has been compiled and there is an execution
plan available for it) which leads to better performance</p></li>
<li><p>sends only the statement id and its parameters (thus reducing the amount of data sent
to the cluster)</p></li>
</ul>
<p>See <a class="reference external" href="../manual/statements/prepared/">Prepared statements</a> for more information.</p>
</div>
<div class="section" id="can-i-combine-preparedstatements-and-normal-statements-in-a-batch">
<h2>Can I combine <code class="docutils literal notranslate"><span class="pre">PreparedStatements</span></code> and normal statements in a batch?<a class="headerlink" href="#can-i-combine-preparedstatements-and-normal-statements-in-a-batch" title="Permalink to this headline">¶</a></h2>
<p>Yes. A batch can include both bound statements and simple statements:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">PreparedStatement</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span> <span class="s">&quot;INSERT INTO contacts (email, firstname, lastname)</span>
<span class="s">      VALUES (?, ?, ?)&quot;</span><span class="o">);</span>
<span class="n">BatchStatement</span> <span class="n">batch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BatchStatement</span><span class="o">();</span>
<span class="n">batch</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">ps</span><span class="o">.</span><span class="na">bind</span><span class="o">(...));</span>
<span class="n">batch</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">ps</span><span class="o">.</span><span class="na">bind</span><span class="o">(...));</span>
<span class="c1">// here&#39;s a simple statement</span>
<span class="n">batch</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleStatement</span><span class="o">(</span> <span class="s">&quot;INSERT INTO contacts (email, firstname, lastname) VALUES (?, ?, ?)&quot;</span><span class="o">,</span> <span class="o">...));</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">batch</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="why-do-my-select-preparedstatement-based-queries-stop-working-after-a-schema-change">
<h2>Why do my ‘SELECT *’ <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code>-based queries stop working after a schema change?<a class="headerlink" href="#why-do-my-select-preparedstatement-based-queries-stop-working-after-a-schema-change" title="Permalink to this headline">¶</a></h2>
<p>Both the driver and Cassandra maintain a mapping of <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code> queries to their
metadata.  When a change is made to a table, such as a column being added or dropped, there
is currently no mechanism for Cassandra to invalidate the existing metadata.  Because of this,
the driver is not able to properly react to these changes and will improperly read rows after
a schema change is made.</p>
<p>See <a class="reference external" href="../manual/statements/prepared">Prepared statements</a> for more information.</p>
</div>
<div class="section" id="can-i-get-the-raw-bytes-of-a-text-column">
<h2>Can I get the raw bytes of a text column?<a class="headerlink" href="#can-i-get-the-raw-bytes-of-a-text-column" title="Permalink to this headline">¶</a></h2>
<p>If you need to access the raw bytes of a text column, call the
<code class="docutils literal notranslate"><span class="pre">Row.getBytesUnsafe(&quot;columnName&quot;)</span></code> method.</p>
<p>Trying to use <code class="docutils literal notranslate"><span class="pre">Row.getBytes(&quot;columnName&quot;)</span></code> for the same purpose results in an
exception, as the <code class="docutils literal notranslate"><span class="pre">getBytes</span></code> method can only be used if the column has the CQL type <code class="docutils literal notranslate"><span class="pre">BLOB</span></code>.</p>
</div>
<div class="section" id="how-do-i-increment-counters-with-querybuilder">
<h2>How do I increment counters with <code class="docutils literal notranslate"><span class="pre">QueryBuilder</span></code>?<a class="headerlink" href="#how-do-i-increment-counters-with-querybuilder" title="Permalink to this headline">¶</a></h2>
<p>Considering the following query:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">clickstream</span> <span class="n">SET</span> <span class="n">clicks</span> <span class="o">=</span> <span class="n">clicks</span> <span class="o">+</span> <span class="mi">1</span> <span class="n">WHERE</span> <span class="n">userid</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
</pre></div>
</div>
<p>To do this using <code class="docutils literal notranslate"><span class="pre">QueryBuilder</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Statement</span> <span class="n">query</span> <span class="o">=</span> <span class="n">QueryBuilder</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&quot;clickstream&quot;</span><span class="o">)</span>
                              <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">incr</span><span class="o">(</span><span class="s">&quot;clicks&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">))</span> <span class="c1">// Use incr for counters</span>
                              <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">eq</span><span class="o">(</span><span class="s">&quot;userid&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">));</span>
</pre></div>
</div>
</div>
<div class="section" id="is-there-a-way-to-control-the-batch-size-of-the-results-returned-from-a-query">
<h2>Is there a way to control the batch size of the results returned from a query?<a class="headerlink" href="#is-there-a-way-to-control-the-batch-size-of-the-results-returned-from-a-query" title="Permalink to this headline">¶</a></h2>
<p>Use the <code class="docutils literal notranslate"><span class="pre">setFetchSize()</span></code> method on your <code class="docutils literal notranslate"><span class="pre">Statement</span></code> object. The fetch size controls
how many resulting rows are retrieved simultaneously (the goal being to avoid
loading too many results in memory for queries yielding large result sets).</p>
<p>Keep in mind that if your code iterates the <code class="docutils literal notranslate"><span class="pre">ResultSet</span></code> entirely, the driver may
run additional background queries to fetch the rest of the data. The fetch size
only affects what is retrieved at a time, not the overall number of rows.</p>
<p>See <a class="reference external" href="../manual/paging/">Paging</a> for more information.</p>
</div>
<div class="section" id="what-s-the-difference-between-using-setfetchsize-and-limit">
<h2>What’s the difference between using <code class="docutils literal notranslate"><span class="pre">setFetchSize()</span></code> and <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code>?<a class="headerlink" href="#what-s-the-difference-between-using-setfetchsize-and-limit" title="Permalink to this headline">¶</a></h2>
<p>Basically, <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> controls the maximum number of results returned by the query,
while the <code class="docutils literal notranslate"><span class="pre">setFetchSize()</span></code> method controls the amount of data transferred at a time.</p>
<p>For example, if you limit is 30 and your fetch size is 10, the <code class="docutils literal notranslate"><span class="pre">ResultSet</span></code> will contain
30 rows, but under the hood the driver will perform 3 requests that will transfer 10
rows each.</p>
<p>See <a class="reference external" href="../manual/paging/">Paging</a> for more information.</p>
</div>
<div class="section" id="i-m-reading-a-blob-column-and-the-driver-returns-incorrect-data">
<h2>I’m reading a BLOB column and the driver returns incorrect data.<a class="headerlink" href="#i-m-reading-a-blob-column-and-the-driver-returns-incorrect-data" title="Permalink to this headline">¶</a></h2>
<p>Check your code to ensure that you read the returned <code class="docutils literal notranslate"><span class="pre">ByteBuffer</span></code> correctly. <code class="docutils literal notranslate"><span class="pre">ByteBuffer</span></code> is a very error-prone API,
and we’ve had many reports where the problem turned out to be in user code.</p>
<p>See <a class="reference external" href="https://github.com/datastax/java-driver/tree/3.x/driver-examples/src/main/java/com/datastax/driver/examples/datatypes/Blobs.java">Blobs.java</a> in the <code class="docutils literal notranslate"><span class="pre">driver-examples</span></code> module for some examples and explanations.</p>
</div>
<div class="section" id="how-do-i-use-the-driver-in-an-osgi-application">
<h2>How do I use the driver in an OSGi application?<a class="headerlink" href="#how-do-i-use-the-driver-in-an-osgi-application" title="Permalink to this headline">¶</a></h2>
<p>Read our <a class="reference external" href="osgi/">OSGi-specific FAQ section</a> to find out.</p>
</div>
<div class="section" id="why-am-i-seeing-messages-about-tombstone-warn-threshold-or-tombstone-fail-threshold-being-exceeded-in-my-cassandra-logs">
<h2>Why am I seeing messages about <code class="docutils literal notranslate"><span class="pre">tombstone_warn_threshold</span></code> or <code class="docutils literal notranslate"><span class="pre">tombstone_fail_threshold</span></code> being exceeded in my Cassandra logs?<a class="headerlink" href="#why-am-i-seeing-messages-about-tombstone-warn-threshold-or-tombstone-fail-threshold-being-exceeded-in-my-cassandra-logs" title="Permalink to this headline">¶</a></h2>
<p>Applications which use the object mapper or set <code class="docutils literal notranslate"><span class="pre">null</span></code> values in their
statements may observe that many tombstones are being stored in their tables
which subsequently may lead to poor query performance, failed queries, or
columns being mysteriously deleted.</p>
<p>This is caused by INSERT/UPDATE statements containing <code class="docutils literal notranslate"><span class="pre">null</span></code> values for columns
that a user does not intend to change.  Common circumstances around this come
from using the object mapper or writing your own persistence layer and
attempting to reuse the same <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code> for inserting data, even with
partial updates.</p>
<p>Prior to cassandra 2.2, there was no means of reusing the same
<code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code> for making partial updates to different columns.</p>
<p>For example, given the following code:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">PreparedStatement</span> <span class="n">prepared</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="s">&quot;INSERT INTO contacts (email, firstname, lastname) VALUES (?, ?, ?)&quot;</span><span class="o">);</span>
<span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">prepared</span><span class="o">.</span><span class="na">bind</span><span class="o">();</span>
<span class="n">bound</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">,</span> <span class="s">&quot;clint.barton@hawkeye.com&quot;</span><span class="o">);</span>
<span class="n">bound</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;firstname&quot;</span><span class="o">,</span> <span class="s">&quot;Barney&quot;</span><span class="o">);</span>
<span class="c1">// creates a tombstone!!</span>
<span class="n">bound</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;lastname&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</pre></div>
</div>
<p>If one wanted to use this query to update only <code class="docutils literal notranslate"><span class="pre">firstname</span></code> this would not
be achievable without binding the <code class="docutils literal notranslate"><span class="pre">lastname</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">null</span></code>.  This would
have an undesired side effect of creating a tombstone for <code class="docutils literal notranslate"><span class="pre">lastname</span></code> and thus
to the user giving the impression that <code class="docutils literal notranslate"><span class="pre">lastname</span></code> was deleted.</p>
<p>In cassandra 2.2 and later with protocol v4, bind parameters (<code class="docutils literal notranslate"><span class="pre">?</span></code>) can
optionally be left unset.
(<a class="reference external" href="https://issues.apache.org/jira/browse/CASSANDRA-7304">CASSANDRA-7304</a>):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">PreparedStatement</span> <span class="n">prepared</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="s">&quot;INSERT INTO contacts (email, firstname, lastname) VALUES (?, ?, ?)&quot;</span><span class="o">);</span>
<span class="n">BoundStatement</span> <span class="n">bound</span> <span class="o">=</span> <span class="n">prepared</span><span class="o">.</span><span class="na">bind</span><span class="o">();</span>
<span class="n">bound</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">,</span> <span class="s">&quot;clint.barton@hawkeye.com&quot;</span><span class="o">);</span>
<span class="n">bound</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;firstname&quot;</span><span class="o">,</span> <span class="s">&quot;Barney&quot;</span><span class="o">);</span>
<span class="c1">// lastname is left unset.</span>
</pre></div>
</div>
<p>See <a class="reference external" href="../manual/statements/prepared/#parameters-and-binding">Parameters and Binding</a> for more details about unset parameters.</p>
<p>Another possible root cause for this is using the object mapper and leaving
fields set to <code class="docutils literal notranslate"><span class="pre">null</span></code>.  This also causes tombstones to be inserted unless
setting <code class="docutils literal notranslate"><span class="pre">saveNullFields</span></code> option to false.
See <a class="reference external" href="../manual/object_mapper/using/#mapper-options">Mapper options</a> for more details.</p>
</div>
<div class="section" id="i-am-encountering-busypoolexception-what-does-this-mean-and-how-do-i-avoid-it">
<h2>I am encountering <code class="docutils literal notranslate"><span class="pre">BusyPoolException</span></code>, what does this mean and how do I avoid it?<a class="headerlink" href="#i-am-encountering-busypoolexception-what-does-this-mean-and-how-do-i-avoid-it" title="Permalink to this headline">¶</a></h2>
<p>Often while writing a bulk loading program or an application that does many concurrent operations a user may encounter
exceptions such as the following:</p>
<blockquote>
<div><p>com.datastax.driver.core.exceptions.BusyPoolException: [/X.X.X.X] Pool is busy (no available connection and the queue
has reached its max size 256)</p>
</div></blockquote>
<p>This typically means that your application is submitting too many concurrent requests and not enforcing any limitation
on the number of requests that are being processed at once.  A common mistake users might make is firing off a bunch
of queries using <code class="docutils literal notranslate"><span class="pre">executeAsync</span></code> and not waiting for them to complete before submitting more.</p>
<p>One simple approach to remedying this is to use something like a <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Semaphore.html">Semaphore</a> to limit the number of concurrent
<code class="docutils literal notranslate"><span class="pre">executeAsync</span></code> requests at a time.  Alternatively, one could submit requests X at a time and collect the returned
<code class="docutils literal notranslate"><span class="pre">ResultSetFuture</span></code>s from <code class="docutils literal notranslate"><span class="pre">executeAsync</span></code> and use <a class="reference external" href="https://google.github.io/guava/releases/19.0/api/docs/com/google/common/util/concurrent/Futures.html#allAsList(java.lang.Iterable)">Futures.allAsList</a> and wait on completion of the resulting future
before submitting the next batch.</p>
<p>See the <a class="reference external" href="../manual/pooling/#acquisition-queue">Acquisition queue</a> section of the Pooling section in the manual for explanation of how the driver enqueues
requests when connections are over-utilized.</p>
</div>
<div class="section" id="what-is-netty-s-native-epoll-transport-and-how-do-i-enable-or-disable-it">
<h2>What is Netty’s native epoll transport and how do I enable or disable it?<a class="headerlink" href="#what-is-netty-s-native-epoll-transport-and-how-do-i-enable-or-disable-it" title="Permalink to this headline">¶</a></h2>
<p>Netty provides <a class="reference external" href="http://netty.io/wiki/native-transports.html">native transport libraries</a> which generally generate less
garbage and improve performance when compared to the default NIO-based transport.
By default if the driver detects the  <code class="docutils literal notranslate"><span class="pre">netty-transport-native-epoll</span></code> library in its classpath it will attempt to use
<a class="reference external" href="https://netty.io/4.0/api/io/netty/channel/epoll/EpollEventLoopGroup.html"><code class="docutils literal notranslate"><span class="pre">EpollEventLoopGroup</span></code></a> for its underlying
event loop.</p>
<p>In the usual case this works fine in linux environments.  On the other hand, many users have run into compatibility
issues when the version of <code class="docutils literal notranslate"><span class="pre">netty-transport-native-epoll</span></code> is not compatible with a version of Netty in an application’s
classpath.  One such case is where an application depends on a version of <code class="docutils literal notranslate"><span class="pre">netty-all</span></code> that is different than the
version of <code class="docutils literal notranslate"><span class="pre">netty-handler</span></code> that the driver depends on.  In such a case, a user may encounter an exception such as the
one described in <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-1535">JAVA-1535</a>.</p>
<p>While the epoll transport may in general improve performance, we expect the improvement to be marginal for a lot of use
cases.  Therefore, if you don’t want <code class="docutils literal notranslate"><span class="pre">netty-transport-native-epoll</span></code> to be used by the driver even if the library is
present in an application’s classpath, the most direct way to disable this is to provide the system property value
<code class="docutils literal notranslate"><span class="pre">-Dcom.datastax.driver.FORCE_NIO=true</span></code> to your application to force the use of the default Netty NIO-based event loop.
If properly used, the following log message will be logged at INFO on startup:</p>
<blockquote>
<div><p>Found Netty’s native epoll transport in the classpath, but NIO was forced through the FORCE_NIO system property.</p>
</div></blockquote>
</div>
<div class="section" id="why-am-i-encountering-nosuchmethodfoundexception-noclassdeffounderror-or-verifyerrors-and-how-do-i-avoid-them">
<h2>Why am I encountering <code class="docutils literal notranslate"><span class="pre">NoSuchMethodFoundException</span></code>, <code class="docutils literal notranslate"><span class="pre">NoClassDefFoundError</span></code>, or <code class="docutils literal notranslate"><span class="pre">VerifyError</span></code>s and how do I avoid them?<a class="headerlink" href="#why-am-i-encountering-nosuchmethodfoundexception-noclassdeffounderror-or-verifyerrors-and-how-do-i-avoid-them" title="Permalink to this headline">¶</a></h2>
<p>Incompatibilities between the java driver and other libraries may cause these exceptions to surface in your
application at runtime.</p>
<p>It could be that an older or newer version of a library that the driver depends on, such as Netty
or Guava, may be present in your application’s classpath.  If using Maven or another dependency
management tool, the tool should offer a command, such as <code class="docutils literal notranslate"><span class="pre">mvn</span> <span class="pre">dependency:tree</span></code> to identify the dependencies
in your project to help you understand the dependent versions across the various libraries you use in your
project.  You may also want to evaluate your classpath to see if there are multiple JARs present for a library,
but with different versions, which could cause compatibility issues.  In addition, consider evaluating
using the Logback logging framework, which provides the capability to include <a class="reference external" href="https://logback.qos.ch/reasonsToSwitch.html#packagingData">packaging data</a> for classes
in stack traces.</p>
<p>For Netty in particular, the driver offers an alternative artifact that shades its Netty dependency,
allowing you to use newer or older versions of Netty in your application without impacting the driver.
See <a class="reference external" href="../manual/shaded_jar">Using the shaded JAR</a> for more details.</p>
<p>Another possibility could be that another library depends on a different version of the driver.
In this case, observe the stacktrace of the exception to see which library is attempting to use
the driver.  To identify compatible versions, check that library’s dependency on the driver to understand
what version is compatible.</p>
<p>Finally, some monitoring and agent-based tools such as <a class="reference external" href="https://www.dynatrace.com/">DynaTrace</a> offer solutions that instrument the driver to
observe and record useful metrics such as request rates, latencies and more.  It is possible that the tool
is not compatible with the version of the java driver you are using.  In this case, check to
see if a newer version of that tool is available that works with this version of the driver.  If no such
version is available, you may want to reach out to the maintainer of that tool to request that they provide
an update with compatibility to this driver version.</p>
</div>
</div>

        </div>

        <div id="sidebar" class="large-3 large-pull-6 columns"><div class="side-nav">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manual/README.html">Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade_guide/README.html">Upgrade guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/README.html">Changelog</a></li>
</ul>

</div>
        </div>

        <div class="large-3 columns">
            
        </div>

    </div>
</section>

<!-- newsleter modal -->

<div id="newsletter_signup" class="reveal-modal tiny radius dark_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <a class="close-reveal-modal" aria-label="Close">×</a>
    <h2 id="modalTitle">Sign up for the Scylla newsletter</h2>
    <div id="mc_embed_signup">
        <form action="//cloudius-systems.us10.list-manage.com/subscribe/post?u=df8bb543c68230d5f7b4dcf78&amp;id=9a4589f144" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
            <div id="mc_embed_signup_scroll">

                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-EMAIL">Email</label></div>
                        <div class="small-9 columns"><input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-FNAME">First Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="FNAME" class="" id="mce-FNAME"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-LNAME">Last Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="LNAME" class="" id="mce-LNAME"></div>
                    </div>
                </div>
                <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;"><input type="text" name="b_df8bb543c68230d5f7b4dcf78_9a4589f144" tabindex="-1" value=""></div>
                <div class="clear"><input type="submit" class="button" value="Sign up" name="subscribe" id="mc-embedded-subscribe"></div>
            </div>
        </form>
    </div>
</div>

<!-- end newsleter modal -->



<!-- footer.html -->
<footer id="footer">
    <div class="footer-top">
        <a class="logo" href="https://www.scylladb.com"><img src="../_static/img/logo-scylla-horizontal-RGB.svg" alt=""></a>
        <div class="footer-links">
            <a class="link" href="https://docs.scylladb.com">Docs</a>
            <a class="link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
            <a class="link" href="https://www.scylladb.com/company/">About Us</a>
            <a class="link button" href="https://github.com/scylladb/java-driver/issues/new?title=Issue in page Frequently Asked Questions&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20http://docs.scylladb.com/faq/README%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix" target="_blank">
                Report an issue on this page</a>
        </div>
        <div class="footer-actions">
            <a class="link-icon" href="https://github.com/ScyllaDB" target="_blank">
                <span class="icon-github2"></span></a>
            <a class="link-icon" href="https://twitter.com/ScyllaDB" target="_blank">
                <span class="icon-twitter"></span></a>
            <a class="link-icon" href="https://www.linkedin.com/company/scylladb"  target="_blank">
                <span class="icon-linkedin2"></span></a>
            <a class="link-icon" href="https://www.facebook.com/scylladb/" target="_blank">
                <span class="icon-facebook"></span></a>
        </div>
    </div>

    <div class="footer-bottom">
        <div class="footer-info">
            <div class="footer-copyright">
                &#169; 2012, ScyllaDB. All rights reserved.
            </div>
            <div class="footer-last-updated">
                Last updated on 20 October 2020.
            </div>
        </div>
        <div class="footer-links">
        </div>
    </div>
</footer>
<!-- end footer.html -->

<!-- bodyscripts.html -->
<!-- at the end of the BODY --> 
<script src="../_static/js/vendor/jquery.js"></script>
<script src="../_static/expertrec.js"></script>
<script src="../_static/js/foundation/foundation.js"></script>
<script src="../_static/js/foundation/foundation.topbar.js"></script>
<script src="../_static/app.js"></script>
<script>
    $(document).foundation();
</script>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <!-- end bodyscripts.html -->
</body>
</html>